{% extends 'base.html' %}

{% block content %}
<style>
    /* Professional Settings Layout */
    .settings-container { display: flex; min-height: 80vh; background: #fff; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); overflow: hidden; }
    .settings-nav { width: 260px; background: #f8f9fa; border-right: 1px solid #eee; padding: 20px 0; }
    .nav-header { padding: 0 25px 15px; font-size: 0.8rem; font-weight: 700; color: #adb5bd; text-transform: uppercase; letter-spacing: 1px; }
    .settings-link { display: flex; align-items: center; padding: 12px 25px; color: #495057; text-decoration: none; transition: all 0.2s; font-weight: 500; font-size: 0.95rem; border-left: 3px solid transparent; cursor: pointer; }
    .settings-link:hover { background: #e9ecef; color: #212529; }
    .settings-link.active { background: #e7f1ff; color: #0d6efd; border-left-color: #0d6efd; }
    .settings-content { flex: 1; padding: 40px; overflow-y: auto; }
    .item-card { background: #fff; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: box-shadow 0.2s; }
    .item-card:hover { border-color: #dee2e6; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
</style>

<div class="settings-container">
    <div class="settings-nav">
        <div class="nav-header">Team Management</div>
        <div class="settings-link active" onclick="showTab('users', this)"><i class="bi bi-shield-lock"></i> System Users</div>
        <div class="settings-link" onclick="showTab('staff', this)"><i class="bi bi-people"></i> Staff Profiles</div>
        <div class="settings-link" onclick="showTab('dept', this)"><i class="bi bi-building"></i> Departments</div>
        
        <div class="nav-header mt-4">Operations Config</div>
        <div class="settings-link" onclick="showTab('clients', this)"><i class="bi bi-briefcase"></i> Clients</div>
        <div class="settings-link" onclick="showTab('cats', this)"><i class="bi bi-tags"></i> Categories</div>
        <div class="settings-link" onclick="showTab('crit', this)"><i class="bi bi-list-check"></i> Review Criteria</div>
    </div>

    <div class="settings-content">
        <div id="tab-users" class="settings-tab">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2>System Users</h2>
                <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addUserModal"><i class="bi bi-plus-lg"></i> Create User</button>
            </div>
            {% for user in system_users %}
            <div class="item-card">
                <div>
                    <h6 class="m-0 fw-bold">{{ user.username }}</h6>
                    <small class="text-muted">{{ user.email }}</small>
                </div>
                <span class="badge bg-success">Active</span>
            </div>
            {% empty %}
            <p class="text-muted">No additional users created.</p>
            {% endfor %}
        </div>

        <div id="tab-staff" class="settings-tab d-none">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2>Staff Profiles</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStaffModal"><i class="bi bi-plus-lg"></i> Add Staff</button>
            </div>
            {% for s in staff_list %}
            <div class="item-card">
                <div><h6 class="m-0 fw-bold">{{ s.full_name }}</h6><small>{{ s.department.name }}</small></div>
                <a href="{% url 'delete_setting_item' 'staff' s.id %}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Delete staff?')"><i class="bi bi-trash"></i></a>
            </div>
            {% empty %}
            <div class="alert alert-info">No staff found. Create a Department first!</div>
            {% endfor %}
        </div>

        <div id="tab-dept" class="settings-tab d-none">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2>Departments</h2>
                <button class="btn btn-info text-white" data-bs-toggle="modal" data-bs-target="#addDeptModal"><i class="bi bi-plus-lg"></i> Add Dept</button>
            </div>
            {% for d in departments %}
            <div class="item-card">
                <strong>{{ d.name }}</strong>
                <a href="{% url 'delete_setting_item' 'dept' d.id %}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Delete dept?')"><i class="bi bi-trash"></i></a>
            </div>
            {% endfor %}
        </div>

        <div id="tab-clients" class="settings-tab d-none">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2>Clients</h2>
                <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#addClientModal"><i class="bi bi-plus-lg"></i> Add Client</button>
            </div>
            <div class="row">
                {% for c in clients %}
                <div class="col-md-6">
                    <div class="item-card" style="border-left: 5px solid {{ c.color }};">
                        <div><strong>{{ c.name }}</strong><br><small>{{ c.contact_person }}</small></div>
                        <a href="{% url 'delete_setting_item' 'client' c.id %}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Delete client?')"><i class="bi bi-trash"></i></a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div id="tab-cats" class="settings-tab d-none">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2>Categories</h2>
                <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#addCatModal"><i class="bi bi-plus-lg"></i> Add Category</button>
            </div>
            <div class="d-flex flex-wrap gap-2">
                {% for c in categories %}
                <div class="badge p-2 fs-6 d-flex align-items-center gap-2" style="background-color: {{ c.color }};">
                    {{ c.name }}
                    <a href="{% url 'delete_setting_item' 'category' c.id %}" class="text-white" onclick="return confirm('Delete category?')"><i class="bi bi-x-circle-fill"></i></a>
                </div>
                {% endfor %}
            </div>
        </div>

        <div id="tab-crit" class="settings-tab d-none">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <h2>Review Criteria</h2>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addCritModal"><i class="bi bi-plus-lg"></i> Add Criteria</button>
            </div>
            <div class="d-flex flex-wrap gap-2">
                {% for c in criteria_list %}
                <div class="badge bg-success p-2 fs-6 d-flex align-items-center gap-2">
                    {{ c.name }}
                    <a href="{% url 'delete_setting_item' 'criteria' c.id %}" class="text-white" onclick="return confirm('Delete criteria?')"><i class="bi bi-x-circle-fill"></i></a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addClientModal">
    <div class="modal-dialog">
        <form method="POST" class="modal-content">
            {% csrf_token %}
            <div class="modal-header bg-warning text-dark"><h5 class="modal-title">Add Client</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <div class="mb-3"><label>Client Name</label>{{ client_form.name }}</div>
                <div class="mb-3"><label>Contact Person</label>{{ client_form.contact_person }}</div>
                <div class="mb-3">
                    <label>Chart Color</label>
                    {{ client_form.color }}
                </div>
                 <div class="mb-3"><label>Active?</label>{{ client_form.is_active }}</div>
            </div>
            <div class="modal-footer"><button type="submit" name="add_client" class="btn btn-warning">Save</button></div>
        </form>
    </div>
</div>

<div class="modal fade" id="addCatModal">
    <div class="modal-dialog">
        <form method="POST" class="modal-content">
            {% csrf_token %}
            <div class="modal-header bg-secondary text-white"><h5 class="modal-title">Add Category</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <div class="mb-3"><label>Name</label>{{ cat_form.name }}</div>
                <div class="mb-3"><label>Chart Color</label>{{ cat_form.color }}</div>
                <div class="mb-3"><label>Active?</label>{{ cat_form.is_active }}</div>
            </div>
            <div class="modal-footer"><button type="submit" name="add_cat" class="btn btn-secondary">Save</button></div>
        </form>
    </div>
</div>

<div class="modal fade" id="addUserModal"><div class="modal-dialog"><form method="POST" class="modal-content">{% csrf_token %}<div class="modal-header bg-dark text-white"><h5>Create User</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body">{{ user_form.as_p }}</div><div class="modal-footer"><button type="submit" name="add_user" class="btn btn-dark">Create</button></div></form></div></div>

<div class="modal fade" id="addStaffModal"><div class="modal-dialog"><form method="POST" enctype="multipart/form-data" class="modal-content">{% csrf_token %}<div class="modal-header bg-primary text-white"><h5>Add Staff</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body">{{ staff_form.as_p }}</div><div class="modal-footer"><button type="submit" name="add_staff" class="btn btn-primary">Save</button></div></form></div></div>

<div class="modal fade" id="addDeptModal"><div class="modal-dialog"><form method="POST" class="modal-content">{% csrf_token %}<div class="modal-header bg-info text-white"><h5>Add Dept</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">{{ dept_form.as_p }}</div><div class="modal-footer"><button type="submit" name="add_dept" class="btn btn-info text-white">Save</button></div></form></div></div>

<div class="modal fade" id="addCritModal"><div class="modal-dialog"><form method="POST" class="modal-content">{% csrf_token %}<div class="modal-header bg-success text-white"><h5>Add Criteria</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body">{{ crit_form.as_p }}</div><div class="modal-footer"><button type="submit" name="add_crit" class="btn btn-success">Save</button></div></form></div></div>

<script>
    function showTab(tabName, linkElement) {
        document.querySelectorAll('.settings-tab').forEach(el => el.classList.add('d-none'));
        document.querySelectorAll('.settings-link').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.remove('d-none');
        linkElement.classList.add('active');
    }
</script>
{% endblock %}