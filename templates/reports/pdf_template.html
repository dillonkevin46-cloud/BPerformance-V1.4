<!DOCTYPE html>
<html>
<head>
    <style>
        @page { size: A4; margin: 1.5cm; }
        body { font-family: Helvetica, sans-serif; font-size: 11px; color: #333; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 20px; }
        h3 { background: #eee; padding: 5px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th { background: #333; color: white; padding: 6px; text-align: left; }
        td { border-bottom: 1px solid #ddd; padding: 6px; vertical-align: top; }
        .badge { background: #ddd; padding: 2px 5px; border-radius: 3px; font-size: 9px; }
        .meta { margin-bottom: 20px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Daily Operations Report</h1>
    
    <div class="meta">
        <strong>Date:</strong> {{ report.date|date:"l, d F Y" }}<br>
        <strong>Generated By:</strong> {{ request.user.username|default:"System" }}<br>
        <strong>Status:</strong> {% if report.is_submitted %}Submitted{% else %}Draft{% endif %}
    </div>

    {% if report.manager_notes %}
    <h3>Manager's Summary</h3>
    <p>{{ report.manager_notes }}</p>
    {% endif %}

    <h3>Operations Log</h3>
    <table>
        <thead>
            <tr>
                <th width="12%">Time</th>
                <th width="15%">Staff</th>
                <th width="15%">Client</th>
                <th width="48%">Details</th>
                <th width="10%">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for t in tickets %}
            <tr>
                <td>
                    {{ t.start_time|time:"H:i" }} - {{ t.end_time|time:"H:i" }}<br>
                    <strong>{{ t.duration_display }}</strong>
                </td>
                <td>{{ t.staff.full_name }}</td>
                <td>{{ t.client.name }}</td>
                <td>
                    {{ t.description }}
                    {% if t.travel_minutes > 0 %}
                    <br><small><i>Travel: {{ t.travel_duration_display }}</i></small>
                    {% endif %}
                </td>
                <td>{{ t.get_status_display }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Staff Pulse</h3>
    <table>
        <thead>
            <tr>
                <th>Staff Member</th>
                <th>Criteria</th>
                <th>Score</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for staff, metrics in staff_metrics_map.items %}
                {% for m in metrics %}
                <tr>
                    {% if forloop.first %}
                        <td rowspan="{{ metrics|length }}"><strong>{{ staff.full_name }}</strong></td>
                    {% endif %}
                    <td>{{ m.criteria.name }}</td>
                    <td>{{ m.score }}/10</td>
                    <td>{{ m.notes }}</td>
                </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
</body>
</html>